<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tailwind to Nordcraft JSON Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* gray-900 */
        }
        .font-mono {
            font-family: 'Fira Code', monospace;
        }
        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; /* gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; /* gray-600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* gray-500 */
        }
        .text-shadow-lg {
             text-shadow: 0 10px 15px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body class="text-gray-200">

    <div class="flex flex-col h-screen">
        <header class="bg-gray-900/80 backdrop-blur-sm border-b border-gray-700/50 p-4 shadow-lg z-10">
            <div class="max-w-7xl mx-auto flex justify-between items-center">
                <h1 class="text-xl font-bold text-white">Tailwind to Nordcraft JSON Converter</h1>
                <div class="flex items-center gap-4">
                     <a href="https://github.com/google/labs-prototypes" target="_blank" class="text-gray-400 hover:text-white transition-colors">
                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35.0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/></svg>
                    </a>
                </div>
            </div>
        </header>

        <main class="flex-grow grid grid-cols-1 md:grid-cols-2 gap-4 p-4 overflow-hidden">
            <div class="flex flex-col bg-gray-900 rounded-lg border border-gray-700/50 overflow-hidden">
                <div class="flex justify-between items-center p-3 bg-gray-800/70 border-b border-gray-700/50">
                    <h2 class="font-semibold text-white">Tailwind HTML Input</h2>
                    <div class="flex gap-2">
                        <button id="paste-from-clipboard-btn" class="text-sm bg-purple-600 hover:bg-purple-500 text-white font-semibold py-1 px-3 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-purple-400">Paste Code</button>
                        <button id="paste-sample-btn" class="text-sm bg-indigo-600 hover:bg-indigo-500 text-white font-semibold py-1 px-3 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-400">Paste Sample</button>
                    </div>
                </div>
                <div class="flex-grow relative">
                    <textarea id="html-input" class="w-full h-full p-4 bg-transparent resize-none focus:outline-none font-mono text-sm leading-relaxed" placeholder="Paste your HTML with Tailwind classes here..."></textarea>
                </div>
            </div>

            <div class="flex flex-col bg-gray-900 rounded-lg border border-gray-700/50 overflow-hidden">
                <div class="flex justify-between items-center p-3 bg-gray-800/70 border-b border-gray-700/50">
                    <h2 class="font-semibold text-white">Nordcraft JSON Output</h2>
                    <button id="copy-btn" class="text-sm bg-emerald-600 hover:bg-emerald-500 text-white font-semibold py-1 px-3 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-400">Copy JSON</button>
                </div>
                <div class="flex-grow relative">
                    <pre id="json-output-container" class="w-full h-full overflow-auto"><code id="json-output" class="language-json p-4 block font-mono text-sm"></code></pre>
                    <div id="output-placeholder" class="absolute inset-0 flex items-center justify-center text-gray-500">
                        JSON output will appear here...
                    </div>
                </div>
            </div>
        </main>
        
        <footer class="p-4 flex justify-center">
             <button id="convert-btn" class="w-full md:w-1/2 lg:w-1/3 bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition-all transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-400/50">
                Convert to Nordcraft JSON
            </button>
        </footer>
    </div>
    
    <div id="toast" class="fixed bottom-5 right-5 bg-gray-800 text-white py-2 px-5 rounded-lg shadow-xl text-sm transition-opacity duration-300 opacity-0">
        <span id="toast-message"></span>
    </div>

    <script type="module">
        // --- Tailwind Map Generation ---
        
        const colors = {
            slate: { 50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1', 400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155', 800: '#1e293b', 900: '#0f172a', 950: '#020617' },
            gray: { 50: '#f9fafb', 100: '#f3f4f6', 200: '#e5e7eb', 300: '#d1d5db', 400: '#9ca3af', 500: '#6b7280', 600: '#4b5563', 700: '#374151', 800: '#1f2937', 900: '#111827', 950: '#030712' },
            zinc: { 50: '#fafafa', 100: '#f4f4f5', 200: '#e4e4e7', 300: '#d4d4d8', 400: '#a1a1aa', 500: '#71717a', 600: '#52525b', 700: '#3f3f46', 800: '#27272a', 900: '#18181b', 950: '#09090b' },
            neutral: { 50: '#fafafa', 100: '#f5f5f5', 200: '#e5e5e5', 300: '#d4d4d4', 400: '#a3a3a3', 500: '#737373', 600: '#525252', 700: '#404040', 800: '#262626', 900: '#171717', 950: '#0a0a0a' },
            stone: { 50: '#fafaf9', 100: '#f5f5f4', 200: '#e7e5e4', 300: '#d6d3d1', 400: '#a8a29e', 500: '#78716c', 600: '#57534e', 700: '#44403c', 800: '#292524', 900: '#1c1917', 950: '#0c0a09' },
            red: { 50: '#fef2f2', 100: '#fee2e2', 200: '#fecaca', 300: '#fca5a5', 400: '#f87171', 500: '#ef4444', 600: '#dc2626', 700: '#b91c1c', 800: '#991b1b', 900: '#7f1d1d', 950: '#450a0a' },
            orange: { 50: '#fff7ed', 100: '#ffedd5', 200: '#fed7aa', 300: '#fdba74', 400: '#fb923c', 500: '#f97316', 600: '#ea580c', 700: '#c2410c', 800: '#9a3412', 900: '#7c2d12', 950: '#431407' },
            amber: { 50: '#fffbeb', 100: '#fef3c7', 200: '#fde68a', 300: '#fcd34d', 400: '#fbbf24', 500: '#f59e0b', 600: '#d97706', 700: '#b45309', 800: '#92400e', 900: '#78350f', 950: '#451a03' },
            yellow: { 50: '#fefce8', 100: '#fef9c3', 200: '#fef08a', 300: '#fde047', 400: '#facc15', 500: '#eab308', 600: '#ca8a04', 700: '#a16207', 800: '#854d0e', 900: '#713f12', 950: '#422006' },
            lime: { 50: '#f7fee7', 100: '#ecfccb', 200: '#d9f99d', 300: '#bef264', 400: '#a3e635', 500: '#84cc16', 600: '#65a30d', 700: '#4d7c0f', 800: '#3f6212', 900: '#365314', 950: '#1a2e05' },
            green: { 50: '#f0fdf4', 100: '#dcfce7', 200: '#bbf7d0', 300: '#86efac', 400: '#4ade80', 500: '#22c55e', 600: '#16a34a', 700: '#15803d', 800: '#166534', 900: '#14532d', 950: '#052e16' },
            emerald: { 50: '#ecfdf5', 100: '#d1fae5', 200: '#a7f3d0', 300: '#6ee7b7', 400: '#34d399', 500: '#10b981', 600: '#059669', 700: '#047857', 800: '#065f46', 900: '#064e3b', 950: '#022c22' },
            teal: { 50: '#f0fdfa', 100: '#ccfbf1', 200: '#99f6e4', 300: '#5eead4', 400: '#2dd4bf', 500: '#14b8a6', 600: '#0d9488', 700: '#0f766e', 800: '#115e59', 900: '#134e4a', 950: '#042f2e' },
            cyan: { 50: '#ecfeff', 100: '#cffafe', 200: '#a5f3fc', 300: '#67e8f9', 400: '#22d3ee', 500: '#06b6d4', 600: '#0891b2', 700: '#0e7490', 800: '#155e75', 900: '#164e63', 950: '#083344' },
            sky: { 50: '#f0f9ff', 100: '#e0f2fe', 200: '#bae6fd', 300: '#7dd3fc', 400: '#38bdf8', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1', 800: '#075985', 900: '#0c4a6e', 950: '#082f49' },
            blue: { 50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd', 400: '#60a5fa', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a', 950: '#172554' },
            indigo: { 50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc', 400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 800: '#3730a3', 900: '#312e81', 950: '#1e1b4b' },
            violet: { 50: '#f5f3ff', 100: '#ede9fe', 200: '#ddd6fe', 300: '#c4b5fd', 400: '#a78bfa', 500: '#8b5cf6', 600: '#7c3aed', 700: '#6d28d9', 800: '#5b21b6', 900: '#4c1d95', 950: '#2e1065' },
            purple: { 50: '#faf5ff', 100: '#f3e8ff', 200: '#e9d5ff', 300: '#d8b4fe', 400: '#c084fc', 500: '#a855f7', 600: '#9333ea', 700: '#7e22ce', 800: '#6b21a8', 900: '#581c87', 950: '#3b0764' },
            fuchsia: { 50: '#fdf4ff', 100: '#fae8ff', 200: '#f5d0fe', 300: '#f0abfc', 400: '#e879f9', 500: '#d946ef', 600: '#c026d3', 700: '#a21caf', 800: '#86198f', 900: '#701a75', 950: '#4a044e' },
            pink: { 50: '#fdf2f8', 100: '#fce7f3', 200: '#fbcfe8', 300: '#f9a8d4', 400: '#f472b6', 500: '#ec4899', 600: '#db2777', 700: '#be185d', 800: '#9d174d', 900: '#831843', 950: '#500724' },
            rose: { 50: '#fff1f2', 100: '#ffe4e6', 200: '#fecdd3', 300: '#fda4af', 400: '#fb7185', 500: '#f43f5e', 600: '#e11d48', 700: '#be123c', 800: '#9f1239', 900: '#881337', 950: '#4c0519' },
        };

        const generatedColorUtilities = {};
        const colorProps = {
            'bg': 'background-color', 'text': 'color', 'border': 'border-color',
            'ring': '--ring-color', 'ring-offset': '--ring-offset-color',
            'accent': 'accent-color', 'caret': 'caret-color', 'fill': 'fill', 'stroke': 'stroke',
            'decoration': 'text-decoration-color',
            'from': '--tw-gradient-from-color', 'via': '--tw-gradient-via-color', 'to': '--tw-gradient-to-color',
            'divide': '--tw-divide-color',
            'shadow': '--tw-shadow-color',
            'outline': 'outline-color',
        };
        for (const colorName in colors) {
            for (const shade in colors[colorName]) {
                const hex = colors[colorName][shade];
                for (const propPrefix in colorProps) {
                    const cssProp = colorProps[propPrefix];
                    generatedColorUtilities[`${propPrefix}-${colorName}-${shade}`] = { [cssProp]: hex };
                }
            }
        }
         // Add special colors
        for (const propPrefix in colorProps) {
            const cssProp = colorProps[propPrefix];
            generatedColorUtilities[`${propPrefix}-transparent`] = { [cssProp]: 'transparent' };
            generatedColorUtilities[`${propPrefix}-current`] = { [cssProp]: 'currentColor' };
            generatedColorUtilities[`${propPrefix}-black`] = { [cssProp]: '#000' };
            generatedColorUtilities[`${propPrefix}-white`] = { [cssProp]: '#fff' };
        }

        const spacingScale = { '0': '0px', 'px': '1px', '0.5': '0.125rem', '1': '0.25rem', '1.5': '0.375rem', '2': '0.5rem', '2.5': '0.625rem', '3': '0.75rem', '3.5': '0.875rem', '4': '1rem', '5': '1.25rem', '6': '1.5rem', '7': '1.75rem', '8': '2rem', '9': '2.25rem', '10': '2.5rem', '11': '2.75rem', '12': '3rem', '14': '3.5rem', '16': '4rem', '20': '5rem', '24': '6rem', '28': '7rem', '32': '8rem', '36': '9rem', '40': '10rem', '44': '11rem', '48': '12rem', '52': '13rem', '56': '14rem', '60': '15rem', '64': '16rem', '72': '18rem', '80': '20rem', '96': '24rem' };
        
        const genSpacing = (prefix, prop) => Object.fromEntries(Object.entries(spacingScale).map(([k, v]) => [`${prefix}-${k}`, { [prop]: v }]));
        const genXYSpacing = (prefix, propX, propY) => Object.fromEntries(Object.entries(spacingScale).map(([k, v]) => [`${prefix}-${k}`, { [propX]: v, [propY]: v }]));
        const genNegativeMargin = (prefix, prop) => Object.fromEntries(Object.entries(spacingScale).filter(([k,v]) => v!=='0px').map(([k, v]) => [`-${prefix}-${k}`, { [prop]: `-${v}` }]));
        
        // --- Generator for complex border-radius classes ---
        const borderRadiusSizes = { 'none': '0px', 'sm': '0.125rem', '': '0.25rem', 'md': '0.375rem', 'lg': '0.5rem', 'xl': '0.75rem', '2xl': '1rem', '3xl': '1.5rem', 'full': '9999px' };
        const borderRadiusSides = { 't': ['top-left', 'top-right'], 'r': ['top-right', 'bottom-right'], 'b': ['bottom-right', 'bottom-left'], 'l': ['top-left', 'bottom-left']};
        const borderRadiusCorners = { 'tl': ['top-left'], 'tr': ['top-right'], 'br': ['bottom-right'], 'bl': ['bottom-left'] };
        
        let borderRadiusUtilities = {};
        for (const [sizeKey, sizeValue] of Object.entries(borderRadiusSizes)) {
            // Full radius: rounded, rounded-sm, etc.
            const key = sizeKey === '' ? 'rounded' : `rounded-${sizeKey}`;
            borderRadiusUtilities[key] = { 'border-radius': sizeValue };
            
            // Side-specific: rounded-t-sm, rounded-r-md, etc.
            for(const [sideKey, sideProps] of Object.entries(borderRadiusSides)) {
                const sideClassKey = `rounded-${sideKey}` + (sizeKey ? `-${sizeKey}`: '');
                const style = {};
                for (const prop of sideProps) { style[`border-${prop}-radius`] = sizeValue; }
                borderRadiusUtilities[sideClassKey] = style;
            }
             // Corner-specific: rounded-tl-sm, rounded-br-md, etc.
            for(const [cornerKey, cornerProps] of Object.entries(borderRadiusCorners)) {
                const cornerClassKey = `rounded-${cornerKey}` + (sizeKey ? `-${sizeKey}`: '');
                 const style = {};
                for (const prop of cornerProps) { style[`border-${prop}-radius`] = sizeValue; }
                borderRadiusUtilities[cornerClassKey] = style;
            }
        }

        // --- Generator for complex inset (top/right/bottom/left) classes ---
        const insetScale = { ...spacingScale, 'auto': 'auto', '1/2': '50%', '1/3': '33.333333%', '2/3': '66.666667%', '1/4': '25%', '3/4': '75%', 'full': '100%' };
        let insetUtilities = {};
        for (const [key, value] of Object.entries(insetScale)) {
            const negValue = value !== 'auto' && value !== '0px' ? `-${value}` : value;
            insetUtilities[`inset-${key}`] = { 'top': value, 'right': value, 'bottom': value, 'left': value };
            insetUtilities[`inset-x-${key}`] = { 'left': value, 'right': value };
            insetUtilities[`inset-y-${key}`] = { 'top': value, 'bottom': value };
            insetUtilities[`top-${key}`] = { 'top': value };
            insetUtilities[`right-${key}`] = { 'right': value };
            insetUtilities[`bottom-${key}`] = { 'bottom': value };
            insetUtilities[`left-${key}`] = { 'left': value };

            if (value !== 'auto' && value !=='0px') {
                 insetUtilities[`-inset-${key}`] = { 'top': negValue, 'right': negValue, 'bottom': negValue, 'left': negValue };
                 insetUtilities[`-inset-x-${key}`] = { 'left': negValue, 'right': negValue };
                 insetUtilities[`-inset-y-${key}`] = { 'top': negValue, 'bottom': negValue };
                 insetUtilities[`-top-${key}`] = { 'top': negValue };
                 insetUtilities[`-right-${key}`] = { 'right': negValue };
                 insetUtilities[`-bottom-${key}`] = { 'bottom': negValue };
                 insetUtilities[`-left-${key}`] = { 'left': negValue };
            }
        }

        const tailwindMap = {
            ...generatedColorUtilities,

            // --- Accessibility ---
            'sr-only': { position: 'absolute', width: '1px', height: '1px', padding: '0', margin: '-1px', overflow: 'hidden', clip: 'rect(0, 0, 0, 0)', 'white-space': 'nowrap', 'border-width': '0' },
            'not-sr-only': { position: 'static', width: 'auto', height: 'auto', padding: '0', margin: '0', overflow: 'visible', clip: 'auto', 'white-space': 'normal' },
            
            // --- Layout ---
            'aspect-auto': { 'aspect-ratio': 'auto' }, 'aspect-square': { 'aspect-ratio': '1 / 1' }, 'aspect-video': { 'aspect-ratio': '16 / 9' },
            'container': { 'width': '100%' },
            ...Object.fromEntries(Array.from({ length: 12 }, (_, i) => i + 1).map(i => [`columns-${i}`, { 'columns': `${i}` }])),
            'columns-auto': { 'columns': 'auto' }, 'columns-3xs': { 'columns': '16rem' }, 'columns-2xs': { 'columns': '18rem' }, 'columns-xs': { 'columns': '20rem' }, 'columns-sm': { 'columns': '24rem' }, 'columns-md': { 'columns': '28rem' }, 'columns-lg': { 'columns': '32rem' }, 'columns-xl': { 'columns': '36rem' }, 'columns-2xl': { 'columns': '42rem' }, 'columns-3xl': { 'columns': '48rem' }, 'columns-4xl': { 'columns': '56rem' }, 'columns-5xl': { 'columns': '64rem' }, 'columns-6xl': { 'columns': '72rem' }, 'columns-7xl': { 'columns': '80rem' },
            'break-after-auto': { 'break-after': 'auto' }, 'break-after-avoid': { 'break-after': 'avoid' }, 'break-after-all': { 'break-after': 'all' }, 'break-after-avoid-page': { 'break-after': 'avoid-page' }, 'break-after-page': { 'break-after': 'page' }, 'break-after-left': { 'break-after': 'left' }, 'break-after-right': { 'break-after': 'right' }, 'break-after-column': { 'break-after': 'column' },
            'break-before-auto': { 'break-before': 'auto' }, 'break-before-avoid': { 'break-before': 'avoid' }, 'break-before-all': { 'break-before': 'all' }, 'break-before-avoid-page': { 'break-before': 'avoid-page' }, 'break-before-page': { 'break-before': 'page' }, 'break-before-left': { 'break-before': 'left' }, 'break-before-right': { 'break-before': 'right' }, 'break-before-column': { 'break-before': 'column' },
            'break-inside-auto': { 'break-inside': 'auto' }, 'break-inside-avoid': { 'break-inside': 'avoid' }, 'break-inside-avoid-page': { 'break-inside': 'avoid-page' }, 'break-inside-avoid-column': { 'break-inside': 'column' },
            'decoration-slice': { 'box-decoration-break': 'slice' }, 'decoration-clone': { 'box-decoration-break': 'clone' },
            'box-border': { 'box-sizing': 'border-box' }, 'box-content': { 'box-sizing': 'content-box' },
            'block': { 'display': 'block' }, 'inline-block': { 'display': 'inline-block' }, 'inline': { 'display': 'inline' }, 'flex': { 'display': 'flex' }, 'inline-flex': { 'display': 'inline-flex' }, 'table': { 'display': 'table' }, 'inline-table': { 'display': 'inline-table' }, 'table-caption': { 'display': 'table-caption' }, 'table-cell': { 'display': 'table-cell' }, 'table-column': { 'display': 'table-column' }, 'table-column-group': { 'display': 'table-column-group' }, 'table-footer-group': { 'display': 'table-footer-group' }, 'table-header-group': { 'display': 'table-header-group' }, 'table-row-group': { 'display': 'table-row-group' }, 'table-row': { 'display': 'table-row' }, 'flow-root': { 'display': 'flow-root' }, 'grid': { 'display': 'grid' }, 'inline-grid': { 'display': 'inline-grid' }, 'contents': { 'display': 'contents' }, 'list-item': { 'display': 'list-item' }, 'hidden': { 'display': 'none' },
            'float-right': { 'float': 'right' }, 'float-left': { 'float': 'left' }, 'float-none': { 'float': 'none' },
            'clear-left': { 'clear': 'left' }, 'clear-right': { 'clear': 'right' }, 'clear-both': { 'clear': 'both' }, 'clear-none': { 'clear': 'none' },
            'isolate': { 'isolation': 'isolate' }, 'isolation-auto': { 'isolation': 'auto' },
            'object-contain': { 'object-fit': 'contain' }, 'object-cover': { 'object-fit': 'cover' }, 'object-fill': { 'object-fit': 'fill' }, 'object-none': { 'object-fit': 'none' }, 'object-scale-down': { 'object-fit': 'scale-down' },
            'object-bottom': { 'object-position': 'bottom' }, 'object-center': { 'object-position': 'center' }, 'object-left': { 'object-position': 'left' }, 'object-left-bottom': { 'object-position': 'left bottom' }, 'object-left-top': { 'object-position': 'left top' }, 'object-right': { 'object-position': 'right' }, 'object-right-bottom': { 'object-position': 'right bottom' }, 'object-right-top': { 'object-position': 'right top' }, 'object-top': { 'object-position': 'top' },
            'overflow-auto': { 'overflow': 'auto' }, 'overflow-x-auto': { 'overflow-x': 'auto' }, 'overflow-y-auto': { 'overflow-y': 'auto' }, 'overflow-hidden': { 'overflow': 'hidden' }, 'overflow-x-hidden': { 'overflow-x': 'hidden' }, 'overflow-y-hidden': { 'overflow-y': 'hidden' }, 'overflow-visible': { 'overflow': 'visible' }, 'overflow-x-visible': { 'overflow-x': 'visible' }, 'overflow-y-visible': { 'overflow-y': 'visible' }, 'overflow-scroll': { 'overflow': 'scroll' }, 'overflow-x-scroll': { 'overflow-x': 'scroll' }, 'overflow-y-scroll': { 'overflow-y': 'scroll' },
            'scrolling-touch': { '-webkit-overflow-scrolling': 'touch' }, 'scrolling-auto': { '-webkit-overflow-scrolling': 'auto' },
            'overscroll-auto': { 'overscroll-behavior': 'auto' }, 'overscroll-y-auto': { 'overscroll-behavior-y': 'auto' }, 'overscroll-x-auto': { 'overscroll-behavior-x': 'auto' }, 'overscroll-contain': { 'overscroll-behavior': 'contain' }, 'overscroll-y-contain': { 'overscroll-behavior-y': 'contain' }, 'overscroll-x-contain': { 'overscroll-behavior-x': 'contain' }, 'overscroll-none': { 'overscroll-behavior': 'none' }, 'overscroll-y-none': { 'overscroll-behavior-y': 'none' }, 'overscroll-x-none': { 'overscroll-behavior-x': 'none' },
            'static': { 'position': 'static' }, 'fixed': { 'position': 'fixed' }, 'absolute': { 'position': 'absolute' }, 'relative': { 'position': 'relative' }, 'sticky': { 'position': 'sticky' },
            ...insetUtilities,
            'visible': { 'visibility': 'visible' }, 'invisible': { 'visibility': 'hidden' }, 'collapse': { 'visibility': 'collapse' },
            ...Object.fromEntries([0, 10, 20, 30, 40, 50].map(i => [`z-${i}`, { 'z-index': i }])), 'z-auto': { 'z-index': 'auto' },

            // --- Borders ---
            ...borderRadiusUtilities,
            'border': { 'border-width': '1px' }, ...Object.fromEntries([0, 2, 4, 8].map(i => [`border-${i}`, { 'border-width': `${i}px` }])),
            'border-t': { 'border-top-width': '1px' }, ...Object.fromEntries([0, 2, 4, 8].map(i => [`border-t-${i}`, { 'border-top-width': `${i}px` }])),
            'border-r': { 'border-right-width': '1px' }, ...Object.fromEntries([0, 2, 4, 8].map(i => [`border-r-${i}`, { 'border-right-width': `${i}px` }])),
            'border-b': { 'border-bottom-width': '1px' }, ...Object.fromEntries([0, 2, 4, 8].map(i => [`border-b-${i}`, { 'border-bottom-width': `${i}px` }])),
            'border-l': { 'border-left-width': '1px' }, ...Object.fromEntries([0, 2, 4, 8].map(i => [`border-l-${i}`, { 'border-left-width': `${i}px` }])),
            'border-solid': { 'border-style': 'solid' }, 'border-dashed': { 'border-style': 'dashed' }, 'border-dotted': { 'border-style': 'dotted' }, 'border-double': { 'border-style': 'double' }, 'border-hidden': { 'border-style': 'hidden' }, 'border-none': { 'border-style': 'none' },
            ...Object.fromEntries([0, 5, 10, 20, 25, 30, 40, 50, 60, 70, 75, 80, 90, 100].map(o => [`border-opacity-${o}`, { '--tw-border-opacity': o / 100 }])),
            'outline-0': { 'outline-width': '0px' }, 'outline-1': { 'outline-width': '1px' }, 'outline-2': { 'outline-width': '2px' }, 'outline-4': { 'outline-width': '4px' }, 'outline-8': { 'outline-width': '8px' },
            'outline': { 'outline-style': 'solid' }, 'outline-dashed': { 'outline-style': 'dashed' }, 'outline-dotted': { 'outline-style': 'dotted' }, 'outline-double': { 'outline-style': 'double' },
            'outline-none': { 'outline': '2px solid transparent', 'outline-offset': '2px' },
            'outline-offset-0': { 'outline-offset': '0px' }, 'outline-offset-1': { 'outline-offset': '1px' }, 'outline-offset-2': { 'outline-offset': '2px' }, 'outline-offset-4': { 'outline-offset': '4px' }, 'outline-offset-8': { 'outline-offset': '8px' },
            'ring-0': {'box-shadow': 'var(--tw-ring-inset) 0 0 0 calc(0px + var(--tw-ring-offset-width)) var(--tw-ring-color)'}, 'ring-1': {'box-shadow': 'var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color)'}, 'ring-2': {'box-shadow': 'var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color)'}, 'ring-4': {'box-shadow': 'var(--tw-ring-inset) 0 0 0 calc(4px + var(--tw-ring-offset-width)) var(--tw-ring-color)'}, 'ring-8': {'box-shadow': 'var(--tw-ring-inset) 0 0 0 calc(8px + var(--tw-ring-offset-width)) var(--tw-ring-color)'}, 'ring': {'box-shadow': 'var(--tw-ring-inset) 0 0 0 calc(3px + var(--tw-ring-offset-width)) var(--tw-ring-color)'},
            'ring-inset': { '--tw-ring-inset': 'inset' },
            ...Object.fromEntries([0, 5, 10, 20, 25, 30, 40, 50, 60, 70, 75, 80, 90, 100].map(o => [`ring-opacity-${o}`, { '--ring-opacity': o / 100 }])),
            'ring-offset-0': { '--ring-offset-width': '0px', 'box-shadow': '0 0 0 var(--ring-offset-width) var(--ring-offset-color), var(--ring-shadow)'}, 'ring-offset-1': { '--ring-offset-width': '1px', 'box-shadow': '0 0 0 var(--ring-offset-width) var(--ring-offset-color), var(--ring-shadow)'}, 'ring-offset-2': { '--ring-offset-width': '2px', 'box-shadow': '0 0 0 var(--tw-ring-offset-width) var(--ring-offset-color), var(--ring-shadow)'}, 'ring-offset-4': { '--ring-offset-width': '4px', 'box-shadow': '0 0 0 var(--ring-offset-width) var(--ring-offset-color), var(--ring-shadow)'}, 'ring-offset-8': { '--ring-offset-width': '8px', 'box-shadow': '0 0 0 var(--ring-offset-width) var(--ring-offset-color), var(--ring-shadow)'},

            // --- Flexbox & Grid ---
            ...Object.fromEntries(Object.entries(spacingScale).map(([k, v]) => [`basis-${k}`, { 'flex-basis': v }])), 'basis-auto': { 'flex-basis': 'auto' }, 'basis-full': { 'flex-basis': '100%' },
            'flex-row': { 'flex-direction': 'row' }, 'flex-row-reverse': { 'flex-direction': 'row-reverse' }, 'flex-col': { 'flex-direction': 'column' }, 'flex-col-reverse': { 'flex-direction': 'column-reverse' },
            'flex-wrap': { 'flex-wrap': 'wrap' }, 'flex-wrap-reverse': { 'flex-wrap': 'wrap-reverse' }, 'flex-nowrap': { 'flex-wrap': 'nowrap' },
            'flex-1': { 'flex': '1 1 0%' }, 'flex-auto': { 'flex': '1 1 auto' }, 'flex-initial': { 'flex': '0 1 auto' }, 'flex-none': { 'flex': 'none' },
            'grow': { 'flex-grow': '1' }, 'grow-0': { 'flex-grow': '0' }, 'shrink': { 'flex-shrink': '1' }, 'shrink-0': { 'flex-shrink': '0' },
            ...Object.fromEntries(Array.from({ length: 13 }, (_, i) => [`order-${i}`, { 'order': `${i}` }])), 'order-first': { 'order': '-9999' }, 'order-last': { 'order': '9999' }, 'order-none': { 'order': '0' },
            ...Object.fromEntries(Array.from({ length: 13 }, (_, i) => i > 0 ? [`grid-cols-${i}`, { 'grid-template-columns': `repeat(${i}, minmax(0, 1fr))` }] : [])), 'grid-cols-none': { 'grid-template-columns': 'none' },
            ...Object.fromEntries(Array.from({ length: 13 }, (_, i) => i > 0 ? [`col-span-${i}`, { 'grid-column': `span ${i} / span ${i}` }] : [])), 'col-span-full': { 'grid-column': '1 / -1' }, ...Object.fromEntries(Array.from({ length: 14 }, (_, i) => i > 0 ? [`col-start-${i}`, { 'grid-column-start': i }] : [])), 'col-start-auto': { 'grid-column-start': 'auto' }, ...Object.fromEntries(Array.from({ length: 14 }, (_, i) => i > 0 ? [`col-end-${i}`, { 'grid-column-end': i }] : [])), 'col-end-auto': { 'grid-column-end': 'auto' },
            ...Object.fromEntries(Array.from({ length: 13 }, (_, i) => i > 0 ? [`grid-rows-${i}`, { 'grid-template-rows': `repeat(${i}, minmax(0, 1fr))` }] : [])), 'grid-rows-none': { 'grid-template-rows': 'none' },
            ...Object.fromEntries(Array.from({ length: 13 }, (_, i) => i > 0 ? [`row-span-${i}`, { 'grid-row': `span ${i} / span ${i}` }] : [])), 'row-span-full': { 'grid-row': '1 / -1' }, ...Object.fromEntries(Array.from({ length: 14 }, (_, i) => i > 0 ? [`row-start-${i}`, { 'grid-row-start': i }] : [])), 'row-start-auto': { 'grid-row-start': 'auto' }, ...Object.fromEntries(Array.from({ length: 14 }, (_, i) => i > 0 ? [`row-end-${i}`, { 'grid-row-end': i }] : [])), 'row-end-auto': { 'grid-row-end': 'auto' },
            'grid-flow-row': { 'grid-auto-flow': 'row' }, 'grid-flow-col': { 'grid-auto-flow': 'column' }, 'grid-flow-dense': { 'grid-auto-flow': 'dense' }, 'grid-flow-row-dense': { 'grid-auto-flow': 'row dense' }, 'grid-flow-col-dense': { 'grid-auto-flow': 'column dense' },
            'auto-cols-auto': { 'grid-auto-columns': 'auto' }, 'auto-cols-min': { 'grid-auto-columns': 'min-content' }, 'auto-cols-max': { 'grid-auto-columns': 'max-content' }, 'auto-cols-fr': { 'grid-auto-columns': 'minmax(0, 1fr)' },
            'auto-rows-auto': { 'grid-auto-rows': 'auto' }, 'auto-rows-min': { 'grid-auto-rows': 'min-content' }, 'auto-rows-max': { 'grid-auto-rows': 'max-content' }, 'auto-rows-fr': { 'grid-auto-rows': 'minmax(0, 1fr)' },
            'justify-normal': {'justify-content': 'normal'}, 'justify-start': { 'justify-content': 'flex-start' }, 'justify-end': { 'justify-content': 'flex-end' }, 'justify-center': { 'justify-content': 'center' }, 'justify-between': { 'justify-content': 'space-between' }, 'justify-around': { 'justify-content': 'space-around' }, 'justify-evenly': { 'justify-content': 'space-evenly' }, 'justify-stretch': { 'justify-content': 'stretch' },
            'justify-items-start': { 'justify-items': 'start' }, 'justify-items-end': { 'justify-items': 'end' }, 'justify-items-center': { 'justify-items': 'center' }, 'justify-items-stretch': { 'justify-items': 'stretch' },
            'justify-self-auto': { 'justify-self': 'auto' }, 'justify-self-start': { 'justify-self': 'start' }, 'justify-self-end': { 'justify-self': 'end' }, 'justify-self-center': { 'justify-self': 'center' }, 'justify-self-stretch': { 'justify-self': 'stretch' },
            'content-normal': {'align-content': 'normal'}, 'content-center': { 'align-content': 'center' }, 'content-start': { 'align-content': 'flex-start' }, 'content-end': { 'align-content': 'flex-end' }, 'content-between': { 'align-content': 'space-between' }, 'content-around': { 'align-content': 'space-around' }, 'content-evenly': { 'align-content': 'space-evenly' }, 'content-baseline': {'align-content': 'baseline'}, 'content-stretch': {'align-content': 'stretch'},
            'items-start': { 'align-items': 'flex-start' }, 'items-end': { 'align-items': 'flex-end' }, 'items-center': { 'align-items': 'center' }, 'items-baseline': { 'align-items': 'baseline' }, 'items-stretch': { 'align-items': 'stretch' },
            'self-auto': { 'align-self': 'auto' }, 'self-start': { 'align-self': 'flex-start' }, 'self-end': { 'align-self': 'flex-end' }, 'self-center': { 'align-self': 'center' }, 'self-stretch': { 'align-self': 'stretch' }, 'self-baseline': { 'align-self': 'baseline' },
            'place-content-center': { 'place-content': 'center' }, 'place-content-start': { 'place-content': 'start' }, 'place-content-end': { 'place-content': 'end' }, 'place-content-between': { 'place-content': 'space-between' }, 'place-content-around': { 'place-content': 'space-around' }, 'place-content-evenly': { 'place-content': 'space-evenly' }, 'place-content-baseline': {'place-content': 'baseline'}, 'place-content-stretch': { 'place-content': 'stretch' },
            'place-items-start': { 'place-items': 'start' }, 'place-items-end': { 'place-items': 'end' }, 'place-items-center': { 'place-items': 'center' }, 'place-items-stretch': { 'place-items': 'stretch' },
            'place-self-auto': { 'place-self': 'auto' }, 'place-self-start': { 'place-self': 'start' }, 'place-self-end': { 'place-self': 'end' }, 'place-self-center': { 'place-self': 'center' }, 'place-self-stretch': { 'place-self': 'stretch' },

            // --- Spacing ---
            ...genSpacing('p', 'padding'), ...genXYSpacing('px', 'padding-left', 'padding-right'), ...genXYSpacing('py', 'padding-top', 'padding-bottom'), ...genSpacing('pt', 'padding-top'), ...genSpacing('pr', 'padding-right'), ...genSpacing('pb', 'padding-bottom'), ...genSpacing('pl', 'padding-left'),
            ...genSpacing('m', 'margin'), ...genXYSpacing('mx', 'margin-left', 'margin-right'), ...genXYSpacing('my', 'margin-top', 'margin-bottom'), ...genSpacing('mt', 'margin-top'), ...genSpacing('mr', 'margin-right'), ...genSpacing('mb', 'margin-bottom'), ...genSpacing('ml', 'margin-left'),
            ...genNegativeMargin('m', 'margin'), ...genNegativeMargin('mx', 'margin-left', 'margin-right'), ...genNegativeMargin('my', 'margin-top', 'margin-bottom'), ...genNegativeMargin('mt', 'margin-top'), ...genNegativeMargin('mr', 'margin-right'), ...genNegativeMargin('mb', 'margin-bottom'), ...genNegativeMargin('ml', 'margin-left'),
            'mx-auto': { 'margin-left': 'auto', 'margin-right': 'auto' },
            
            // --- Sizing ---
            ...Object.fromEntries(Object.entries(spacingScale).map(([k, v]) => [`w-${k}`, { width: v }])), 'w-auto': { 'width': 'auto' }, 'w-1/2': { 'width': '50%' }, 'w-1/3': { 'width': '33.333333%' }, 'w-2/3': { 'width': '66.666667%' }, 'w-1/4': { 'width': '25%' }, 'w-2/4': { 'width': '50%' }, 'w-3/4': { 'width': '75%' }, 'w-1/5': { 'width': '20%' }, 'w-2/5': { 'width': '40%' }, 'w-3/5': { 'width': '60%' }, 'w-4/5': { 'width': '80%' }, 'w-1/6': { 'width': '16.666667%' }, 'w-5/6': { 'width': '83.333333%' }, 'w-full': { 'width': '100%' }, 'w-screen': { 'width': '100vw' }, 'w-min': { 'width': 'min-content' }, 'w-max': { 'width': 'max-content' }, 'w-fit': { 'width': 'fit-content' },
            'min-w-0': { 'min-width': '0px' }, 'min-w-full': { 'min-width': '100%' }, 'min-w-min': { 'min-width': 'min-content' }, 'min-w-max': { 'min-width': 'max-content' }, 'min-w-fit': { 'min-width': 'fit-content' },
            'max-w-0': { 'max-width': '0rem' }, 'max-w-none': { 'max-width': 'none' }, 'max-w-xs': { 'max-width': '20rem' }, 'max-w-sm': { 'max-width': '24rem' }, 'max-w-md': { 'max-width': '28rem' }, 'max-w-lg': { 'max-width': '32rem' }, 'max-w-xl': { 'max-width': '36rem' }, 'max-w-2xl': { 'max-width': '42rem' }, 'max-w-3xl': { 'max-width': '48rem' }, 'max-w-4xl': { 'max-width': '56rem' }, 'max-w-5xl': { 'max-width': '64rem' }, 'max-w-6xl': { 'max-width': '72rem' }, 'max-w-7xl': { 'max-width': '80rem' }, 'max-w-full': { 'max-width': '100%' }, 'max-w-min': { 'max-width': 'min-content' }, 'max-w-max': { 'max-width': 'max-content' }, 'max-w-fit': { 'max-width': 'fit-content' }, 'max-w-prose': { 'max-width': '65ch' },
            ...Object.fromEntries(Object.entries(spacingScale).map(([k, v]) => [`h-${k}`, { height: v }])), 'h-auto': { 'height': 'auto' }, 'h-1/2': { 'height': '50%' }, 'h-1/3': { 'height': '33.333333%' }, 'h-2/3': { 'height': '66.666667%' }, 'h-1/4': { 'height': '25%' }, 'h-2/4': { 'height': '50%' }, 'h-3/4': { 'height': '75%' }, 'h-1/5': { 'height': '20%' }, 'h-2/5': { 'height': '40%' }, 'h-3/5': { 'height': '60%' }, 'h-4/5': { 'height': '80%' }, 'h-1/6': { 'height': '16.666667%' }, 'h-5/6': { 'height': '83.333333%' }, 'h-full': { 'height': '100%' }, 'h-screen': { 'height': '100vh' }, 'h-min': { 'height': 'min-content' }, 'h-max': { 'height': 'max-content' }, 'h-fit': { 'height': 'fit-content' },
            'min-h-0': { 'min-height': '0px' }, 'min-h-full': { 'min-height': '100%' }, 'min-h-screen': { 'min-height': '100vh' }, 'min-h-min': { 'min-height': 'min-content' }, 'min-h-max': { 'min-height': 'max-content' }, 'min-h-fit': { 'min-height': 'fit-content' },
            'max-h-0': { 'max-height': '0px' }, ...Object.fromEntries(Object.entries(spacingScale).map(([k, v]) => [`max-h-${k}`, { 'max-height': v }])), 'max-h-full': { 'max-height': '100%' }, 'max-h-screen': { 'max-height': '100vh' }, 'max-h-min': { 'max-height': 'min-content' }, 'max-h-max': { 'max-height': 'max-content' }, 'max-h-fit': { 'max-height': 'fit-content' },
            ...Object.fromEntries(Object.entries(spacingScale).map(([k, v]) => [`size-${k}`, { width: v, height: v }])),
            
            // --- Typography ---
            'font-sans': { 'font-family': 'ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"' }, 'font-serif': { 'font-family': 'ui-serif, Georgia, Cambria, "Times New Roman", Times, serif' }, 'font-mono': { 'font-family': 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace' },
            'text-xs': { 'font-size': '0.75rem', 'line-height': '1rem' }, 'text-sm': { 'font-size': '0.875rem', 'line-height': '1.25rem' }, 'text-base': { 'font-size': '1rem', 'line-height': '1.5rem' }, 'text-lg': { 'font-size': '1.125rem', 'line-height': '1.75rem' }, 'text-xl': { 'font-size': '1.25rem', 'line-height': '1.75rem' }, 'text-2xl': { 'font-size': '1.5rem', 'line-height': '2rem' }, 'text-3xl': { 'font-size': '1.875rem', 'line-height': '2.25rem' }, 'text-4xl': { 'font-size': '2.25rem', 'line-height': '2.5rem' }, 'text-5xl': { 'font-size': '3rem', 'line-height': '1' }, 'text-6xl': { 'font-size': '3.75rem', 'line-height': '1' }, 'text-7xl': { 'font-size': '4.5rem', 'line-height': '1' }, 'text-8xl': { 'font-size': '6rem', 'line-height': '1' }, 'text-9xl': { 'font-size': '8rem', 'line-height': '1' },
            'antialiased': { '-webkit-font-smoothing': 'antialiased', '-moz-osx-font-smoothing': 'grayscale' }, 'subpixel-antialiased': { '-webkit-font-smoothing': 'auto', '-moz-osx-font-smoothing': 'auto' },
            'italic': { 'font-style': 'italic' }, 'not-italic': { 'font-style': 'normal' },
            'font-thin': { 'font-weight': '100' }, 'font-extralight': { 'font-weight': '200' }, 'font-light': { 'font-weight': '300' }, 'font-normal': { 'font-weight': '400' }, 'font-medium': { 'font-weight': '500' }, 'font-semibold': { 'font-weight': '600' }, 'font-bold': { 'font-weight': '700' }, 'font-extrabold': { 'font-weight': '800' }, 'font-black': { 'font-weight': '900' },
            'tracking-tighter': { 'letter-spacing': '-0.05em' }, 'tracking-tight': { 'letter-spacing': '-0.025em' }, 'tracking-normal': { 'letter-spacing': '0em' }, 'tracking-wide': { 'letter-spacing': '0.025em' }, 'tracking-wider': { 'letter-spacing': '0.05em' }, 'tracking-widest': { 'letter-spacing': '0.1em' },
            'leading-3': { 'line-height': '.75rem' }, 'leading-4': { 'line-height': '1rem' }, 'leading-5': { 'line-height': '1.25rem' }, 'leading-6': { 'line-height': '1.5rem' }, 'leading-7': { 'line-height': '1.75rem' }, 'leading-8': { 'line-height': '2rem' }, 'leading-9': { 'line-height': '2.25rem' }, 'leading-10': { 'line-height': '2.5rem' }, 'leading-none': { 'line-height': '1' }, 'leading-tight': { 'line-height': '1.25' }, 'leading-snug': { 'line-height': '1.375' }, 'leading-normal': { 'line-height': '1.5' }, 'leading-relaxed': { 'line-height': '1.625' }, 'leading-loose': { 'line-height': '2' },
            'list-none': { 'list-style-type': 'none' }, 'list-disc': { 'list-style-type': 'disc' }, 'list-decimal': { 'list-style-type': 'decimal' }, 'list-inside': { 'list-style-position': 'inside' }, 'list-outside': { 'list-style-position': 'outside' },
            'text-left': { 'text-align': 'left' }, 'text-center': { 'text-align': 'center' }, 'text-right': { 'text-align': 'right' }, 'text-justify': { 'text-align': 'justify' }, 'text-start': { 'text-align': 'start' }, 'text-end': { 'text-align': 'end' },
            'underline': { 'text-decoration-line': 'underline' }, 'overline': { 'text-decoration-line': 'overline' }, 'line-through': { 'text-decoration-line': 'line-through' }, 'no-underline': { 'text-decoration-line': 'none' },
            'decoration-solid': { 'text-decoration-style': 'solid' }, 'decoration-double': { 'text-decoration-style': 'double' }, 'decoration-dotted': { 'text-decoration-style': 'dotted' }, 'decoration-dashed': { 'text-decoration-style': 'dashed' }, 'decoration-wavy': { 'text-decoration-style': 'wavy' },
            'decoration-auto': { 'text-decoration-thickness': 'auto' }, 'decoration-from-font': { 'text-decoration-thickness': 'from-font' }, ...Object.fromEntries([0,1,2,4,8].map(i => [`decoration-${i}`, {'text-decoration-thickness': `${i}px`}])),
            ...Object.fromEntries([0,1,2,4,8].map(i => [`underline-offset-${i}`, {'text-underline-offset': `${i}px`}])), 'underline-offset-auto': { 'text-underline-offset': 'auto' },
            'uppercase': { 'text-transform': 'uppercase' }, 'lowercase': { 'text-transform': 'lowercase' }, 'capitalize': { 'text-transform': 'capitalize' }, 'normal-case': { 'text-transform': 'none' },
            'truncate': { 'overflow': 'hidden', 'text-overflow': 'ellipsis', 'white-space': 'nowrap' }, 'text-ellipsis': { 'text-overflow': 'ellipsis' }, 'text-clip': { 'text-overflow': 'clip' },
            'text-wrap': { 'text-wrap': 'wrap' }, 'text-nowrap': { 'text-wrap': 'nowrap' }, 'text-balance': { 'text-wrap': 'balance' },
            'indent-px': {'text-indent': '1px'}, ...genSpacing('indent', 'text-indent'),
            'align-baseline': { 'vertical-align': 'baseline' }, 'align-top': { 'vertical-align': 'top' }, 'align-middle': { 'vertical-align': 'middle' }, 'align-bottom': { 'vertical-align': 'bottom' }, 'align-text-top': { 'vertical-align': 'text-top' }, 'align-text-bottom': { 'vertical-align': 'text-bottom' }, 'align-sub': { 'vertical-align': 'sub' }, 'align-super': { 'vertical-align': 'super' },
            'whitespace-normal': { 'white-space': 'normal' }, 'whitespace-nowrap': { 'white-space': 'nowrap' }, 'whitespace-pre': { 'white-space': 'pre' }, 'whitespace-pre-line': { 'white-space': 'pre-line' }, 'whitespace-pre-wrap': { 'white-space': 'pre-wrap' }, 'whitespace-break-spaces': {'white-space': 'break-spaces'},
            'break-normal': { 'overflow-wrap': 'normal', 'word-break': 'normal' }, 'break-words': { 'overflow-wrap': 'break-word' }, 'break-all': { 'word-break': 'break-all' }, 'break-keep': { 'word-break': 'keep-all' },
            'content-none': { 'content': 'none' },

            // --- Backgrounds ---
            'bg-fixed': { 'background-attachment': 'fixed' }, 'bg-local': { 'background-attachment': 'local' }, 'bg-scroll': { 'background-attachment': 'scroll' },
            'bg-clip-border': { 'background-clip': 'border-box' }, 'bg-clip-padding': { 'background-clip': 'padding-box' }, 'bg-clip-content': { 'background-clip': 'content-box' }, 'bg-clip-text': { 'background-clip': 'text' },
            ...Object.fromEntries([0, 5, 10, 20, 25, 30, 40, 50, 60, 70, 75, 80, 90, 95, 100].map(o => [`bg-opacity-${o}`, { '--tw-bg-opacity': o / 100 }])),
            'bg-origin-border': { 'background-origin': 'border-box' }, 'bg-origin-padding': { 'background-origin': 'padding-box' }, 'bg-origin-content': { 'background-origin': 'content-box' },
            'bg-bottom': { 'background-position': 'bottom' }, 'bg-center': { 'background-position': 'center' }, 'bg-left': { 'background-position': 'left' }, 'bg-left-bottom': { 'background-position': 'left bottom' }, 'bg-left-top': { 'background-position': 'left top' }, 'bg-right': { 'background-position': 'right' }, 'bg-right-bottom': { 'background-position': 'right bottom' }, 'bg-right-top': { 'background-position': 'right top' }, 'bg-top': { 'background-position': 'top' },
            'bg-repeat': { 'background-repeat': 'repeat' }, 'bg-no-repeat': { 'background-repeat': 'no-repeat' }, 'bg-repeat-x': { 'background-repeat': 'repeat-x' }, 'bg-repeat-y': { 'background-repeat': 'repeat-y' }, 'bg-repeat-round': { 'background-repeat': 'round' }, 'bg-repeat-space': { 'background-repeat': 'space' },
            'bg-auto': { 'background-size': 'auto' }, 'bg-cover': { 'background-size': 'cover' }, 'bg-contain': { 'background-size': 'contain' },
            'bg-none': { 'background-image': 'none' },
            'bg-gradient-to-t': { 'background-image': 'linear-gradient(to top, var(--tw-gradient-stops))' }, 'bg-gradient-to-tr': { 'background-image': 'linear-gradient(to top right, var(--tw-gradient-stops))' }, 'bg-gradient-to-r': { 'background-image': 'linear-gradient(to right, var(--tw-gradient-stops))' }, 'bg-gradient-to-br': { 'background-image': 'linear-gradient(to bottom right, var(--tw-gradient-stops))' }, 'bg-gradient-to-b': { 'background-image': 'linear-gradient(to bottom, var(--tw-gradient-stops))' }, 'bg-gradient-to-bl': { 'background-image': 'linear-gradient(to bottom left, var(--tw-gradient-stops))' }, 'bg-gradient-to-l': { 'background-image': 'linear-gradient(to left, var(--tw-gradient-stops))' }, 'bg-gradient-to-tl': { 'background-image': 'linear-gradient(to top left, var(--tw-gradient-stops))' },
            
            // --- Effects ---
            'shadow-xs': {'box-shadow': '0 0 0 1px rgba(0, 0, 0, 0.05)'},
            'shadow-sm': { 'box-shadow': '0 1px 2px 0 rgb(0 0 0 / 0.05)' },
            'shadow': { 'box-shadow': '0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1)' },
            'shadow-md': { 'box-shadow': '0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)' },
            'shadow-lg': { 'box-shadow': '0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)' },
            'shadow-xl': { 'box-shadow': '0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1)' },
            'shadow-2xl': { 'box-shadow': '0 25px 50px -12px rgb(0 0 0 / 0.25)' },
            'shadow-inner': { 'box-shadow': 'inset 0 2px 4px 0 rgb(0 0 0 / 0.05)' },
            'shadow-outline': {'box-shadow': '0 0 0 3px rgba(59, 130, 246, 0.5)'},
            'shadow-none': { 'box-shadow': 'none' },
            ...Object.fromEntries([0, 5, 10, 20, 25, 30, 40, 50, 60, 70, 75, 80, 90, 100].map(o => [`opacity-${o}`, { opacity: o / 100 }])),
            'mix-blend-normal': { 'mix-blend-mode': 'normal' }, 'mix-blend-multiply': { 'mix-blend-mode': 'multiply' }, 'mix-blend-screen': { 'mix-blend-mode': 'screen' }, 'mix-blend-overlay': { 'mix-blend-mode': 'overlay' }, 'mix-blend-darken': { 'mix-blend-mode': 'darken' }, 'mix-blend-lighten': { 'mix-blend-mode': 'lighten' }, 'mix-blend-color-dodge': { 'mix-blend-mode': 'color-dodge' }, 'mix-blend-color-burn': { 'mix-blend-mode': 'color-burn' }, 'mix-blend-hard-light': { 'mix-blend-mode': 'hard-light' }, 'mix-blend-soft-light': { 'mix-blend-mode': 'soft-light' }, 'mix-blend-difference': { 'mix-blend-mode': 'difference' }, 'mix-blend-exclusion': { 'mix-blend-mode': 'exclusion' }, 'mix-blend-hue': { 'mix-blend-mode': 'hue' }, 'mix-blend-saturation': { 'mix-blend-mode': 'saturation' }, 'mix-blend-color': { 'mix-blend-mode': 'color' }, 'mix-blend-luminosity': { 'mix-blend-mode': 'luminosity' },
            'bg-blend-normal': {'background-blend-mode': 'normal'}, 'bg-blend-multiply': {'background-blend-mode': 'multiply'}, 'bg-blend-screen': {'background-blend-mode': 'screen'}, 'bg-blend-overlay': {'background-blend-mode': 'overlay'}, 'bg-blend-darken': {'background-blend-mode': 'darken'}, 'bg-blend-lighten': {'background-blend-mode': 'lighten'}, 'bg-blend-color-dodge': {'background-blend-mode': 'color-dodge'}, 'bg-blend-color-burn': {'background-blend-mode': 'color-burn'}, 'bg-blend-hard-light': {'background-blend-mode': 'hard-light'}, 'bg-blend-soft-light': {'background-blend-mode': 'soft-light'}, 'bg-blend-difference': {'background-blend-mode': 'difference'}, 'bg-blend-exclusion': {'background-blend-mode': 'exclusion'}, 'bg-blend-hue': {'background-blend-mode': 'hue'}, 'bg-blend-saturation': {'background-blend-mode': 'saturation'}, 'bg-blend-color': {'background-blend-mode': 'color'}, 'bg-blend-luminosity': {'background-blend-mode': 'luminosity'},

            // --- Tables ---
            'border-collapse': { 'border-collapse': 'collapse' }, 'border-separate': { 'border-collapse': 'separate' },
            ...genXYSpacing('border-spacing', '--tw-border-spacing-x', '--tw-border-spacing-y'), ...genSpacing('border-spacing-x', '--tw-border-spacing-x'), ...genSpacing('border-spacing-y', '--tw-border-spacing-y'),
            'table-auto': { 'table-layout': 'auto' }, 'table-fixed': { 'table-layout': 'fixed' },

            // --- Interactivity ---
            'appearance-none': { 'appearance': 'none' },
            'cursor-auto': {'cursor': 'auto'}, 'cursor-default': {'cursor': 'default'}, 'cursor-pointer': {'cursor': 'pointer'}, 'cursor-wait': {'cursor': 'wait'}, 'cursor-text': {'cursor': 'text'}, 'cursor-move': {'cursor': 'move'}, 'cursor-help': {'cursor': 'help'}, 'cursor-not-allowed': {'cursor': 'not-allowed'}, 'cursor-none': {'cursor': 'none'}, 'cursor-context-menu': {'cursor': 'context-menu'}, 'cursor-progress': {'cursor': 'progress'}, 'cursor-cell': {'cursor': 'cell'}, 'cursor-crosshair': {'cursor': 'crosshair'}, 'cursor-vertical-text': {'cursor': 'vertical-text'}, 'cursor-alias': {'cursor': 'alias'}, 'cursor-copy': {'cursor': 'copy'}, 'cursor-no-drop': {'cursor': 'no-drop'}, 'cursor-grab': {'cursor': 'grab'}, 'cursor-grabbing': {'cursor': 'grabbing'}, 'cursor-all-scroll': {'cursor': 'all-scroll'}, 'cursor-col-resize': {'cursor': 'col-resize'}, 'cursor-row-resize': {'cursor': 'row-resize'}, 'cursor-n-resize': {'cursor': 'n-resize'}, 'cursor-e-resize': {'cursor': 'e-resize'}, 'cursor-s-resize': {'cursor': 's-resize'}, 'cursor-w-resize': {'cursor': 'w-resize'}, 'cursor-ne-resize': {'cursor': 'ne-resize'}, 'cursor-nw-resize': {'cursor': 'nw-resize'}, 'cursor-se-resize': {'cursor': 'se-resize'}, 'cursor-sw-resize': {'cursor': 'sw-resize'}, 'cursor-ew-resize': {'cursor': 'ew-resize'}, 'cursor-ns-resize': {'cursor': 'ns-resize'}, 'cursor-nesw-resize': {'cursor': 'nesw-resize'}, 'cursor-nwse-resize': {'cursor': 'nwse-resize'}, 'cursor-zoom-in': {'cursor': 'zoom-in'}, 'cursor-zoom-out': {'cursor': 'zoom-out'},
            'pointer-events-none': { 'pointer-events': 'none' }, 'pointer-events-auto': { 'pointer-events': 'auto' },
            'resize-none': { 'resize': 'none' }, 'resize': { 'resize': 'both' }, 'resize-y': { 'resize': 'vertical' }, 'resize-x': { 'resize': 'horizontal' },
            'scroll-auto': { 'scroll-behavior': 'auto' }, 'scroll-smooth': { 'scroll-behavior': 'smooth' },
            ...genSpacing('scroll-m', 'scroll-margin'), ...genXYSpacing('scroll-mx', 'scroll-margin-left', 'scroll-margin-right'), ...genXYSpacing('scroll-my', 'scroll-margin-top', 'scroll-margin-bottom'), ...genSpacing('scroll-mt', 'scroll-margin-top'), ...genSpacing('scroll-mr', 'scroll-margin-right'), ...genSpacing('scroll-mb', 'scroll-margin-bottom'), ...genSpacing('scroll-ml', 'scroll-margin-left'),
            ...genSpacing('scroll-p', 'scroll-padding'), ...genXYSpacing('scroll-px', 'scroll-padding-left', 'scroll-padding-right'), ...genXYSpacing('scroll-py', 'scroll-padding-top', 'scroll-padding-bottom'), ...genSpacing('scroll-pt', 'scroll-padding-top'), ...genSpacing('scroll-pr', 'scroll-padding-right'), ...genSpacing('scroll-pb', 'scroll-padding-bottom'), ...genSpacing('scroll-pl', 'scroll-padding-left'),
            'snap-start': { 'scroll-snap-align': 'start' }, 'snap-end': { 'scroll-snap-align': 'end' }, 'snap-center': { 'scroll-snap-align': 'center' }, 'snap-align-none': { 'scroll-snap-align': 'none' },
            'snap-normal': { 'scroll-snap-stop': 'normal' }, 'snap-always': { 'scroll-snap-stop': 'always' },
            'snap-none': { 'scroll-snap-type': 'none' }, 'snap-x': { 'scroll-snap-type': 'x var(--tw-scroll-snap-strictness)' }, 'snap-y': { 'scroll-snap-type': 'y var(--tw-scroll-snap-strictness)' }, 'snap-both': { 'scroll-snap-type': 'both var(--tw-scroll-snap-strictness)' },
            'snap-mandatory': { '--tw-scroll-snap-strictness': 'mandatory' }, 'snap-proximity': { '--tw-scroll-snap-strictness': 'proximity' },
            'touch-auto': { 'touch-action': 'auto' }, 'touch-none': { 'touch-action': 'none' }, 'touch-pan-x': { 'touch-action': 'pan-x' }, 'touch-pan-left': { 'touch-action': 'pan-left' }, 'touch-pan-right': { 'touch-action': 'pan-right' }, 'touch-pan-y': { 'touch-action': 'pan-y' }, 'touch-pan-up': { 'touch-action': 'pan-up' }, 'touch-pan-down': { 'touch-action': 'pan-down' }, 'touch-pinch-zoom': { 'touch-action': 'pinch-zoom' }, 'touch-manipulation': { 'touch-action': 'manipulation' },
            'select-none': { 'user-select': 'none' }, 'select-text': { 'user-select': 'text' }, 'select-all': { 'user-select': 'all' }, 'select-auto': { 'user-select': 'auto' },
            'will-change-auto': { 'will-change': 'auto' }, 'will-change-scroll': { 'will-change': 'scroll-position' }, 'will-change-contents': { 'will-change': 'contents' }, 'will-change-transform': { 'will-change': 'transform' },
        };
        
        const sampleHtml = `<div class="min-h-screen bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');">
    <div class="flex p-4">
        <div class="w-64 bg-gray-800 p-4 rounded-lg shadow-lg">Sidebar</div>
        <div class="grow p-4 ml-4 bg-gray-800/50 rounded-lg shadow-lg">
            <h1 class="text-white font-bold text-xl">Main Content</h1>
            <p class="text-white/80">This element uses 'grow' which maps to 'flex-grow: 1'.</p>
        </div>
    </div>
</div>`;
        
        const htmlInput = document.getElementById('html-input');
        const jsonOutput = document.getElementById('json-output');
        const outputPlaceholder = document.getElementById('output-placeholder');
        const convertBtn = document.getElementById('convert-btn');
        const copyBtn = document.getElementById('copy-btn');
        const pasteSampleBtn = document.getElementById('paste-sample-btn');
        const pasteFromClipboardBtn = document.getElementById('paste-from-clipboard-btn');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');

        /**
         * Converts a hex color string to an rgba string.
         * @param {string} hex - The hex color (e.g., '#RRGGBB').
         * @param {number} alpha - The alpha value (0 to 1).
         * @returns {string|null} - The rgba string or null if hex is invalid.
         */
        function hexToRgba(hex, alpha) {
            if (!/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)) return null;
            let c = hex.substring(1).split('');
            if (c.length === 3) {
                c = [c[0], c[0], c[1], c[1], c[2], c[2]];
            }
            c = '0x' + c.join('');
            return `rgba(${[(c>>16)&255, (c>>8)&255, c&255].join(',')},${alpha})`;
        }
        
        // Maps Tailwind prefixes to the desired JSON keys for variants.
        const pseudoClassMap = {
            'hover': 'hover',
            'active': 'active',
            'focus-visible': 'focus-visible',
            'disabled': 'disabled',
            'focus': 'focus',
            'focus-within': 'focus-within',
            'even': 'nth-child(even)',
            'odd': 'nth-child(odd)',
            'checked': 'checked',
            'first': 'first-child',
            'last': 'last-child',
            'invalid': 'invalid',
            'empty': 'empty',
            'popover-open': 'popover-open',
            'autofill': 'autofill',
            'visited': 'visited',
            'required': 'required',
            'valid': 'valid',
            'placeholder': 'placeholder',
            'group-hover': 'group-hover',
            'dark': 'dark'
        };

        /**
         * A helper function that runs after initial parsing to compose complex utilities
         * like gradients and conditionally apply others like gaps.
         * @param {object} styleObject - The style object to process.
         * @param {object} baseStyleContext - The base style of the element, for context.
         */
        const postProcessStyle = (styleObject, baseStyleContext) => {
            // --- Compose Gradients ---
            if (styleObject['background-image'] && styleObject['background-image'].includes('var(--tw-gradient-stops)')) {
                const from = styleObject['--tw-gradient-from-color'];
                const via = styleObject['--tw-gradient-via-color'];
                const to = styleObject['--tw-gradient-to-color'];
                
                let stops = [];
                if (from) stops.push(from);
                if (via) stops.push(via);
                
                if (to) {
                    stops.push(to);
                } else if (from && !to) {
                     stops.push('rgba(255,255,255,0)');
                }

                if (stops.length > 0) {
                    styleObject['background-image'] = styleObject['background-image']
                        .replace('var(--tw-gradient-stops)', stops.join(', '));
                } else {
                    delete styleObject['background-image'];
                }
            }
            // Clean up temporary gradient color properties regardless.
            delete styleObject['--tw-gradient-from-color'];
            delete styleObject['--tw-gradient-via-color'];
            delete styleObject['--tw-gradient-to-color'];

            // --- Clean Gaps ---
            const hasGap = 'column-gap' in styleObject || 'row-gap' in styleObject;
            if (hasGap) {
                const effectiveDisplay = styleObject.display || baseStyleContext.display;
                const isFlexOrGrid = effectiveDisplay && (effectiveDisplay.includes('flex') || effectiveDisplay.includes('grid'));
                
                if (!isFlexOrGrid) {
                    delete styleObject['column-gap'];
                    delete styleObject['row-gap'];
                }
            }
        };

        // Regular expression to catch special child-styling utilities.
        const directiveRegex = /^(space-[xy](-[\d.px]+|-reverse)|divide-[xy](-[\d.px]+|-reverse)?|divide-(solid|dashed|dotted|double|none)|divide(-\w+-\d+))$/;

        function parseTailwind(classString) {
            const style = {};
            let variants = [];
            const groupedVariants = {};
            const directives = [];

            const classes = classString.split(/\s+/).filter(c => c);
            
            const responsivePrefixes = { 'sm': '40rem', 'md': '48rem', 'lg': '64rem', 'xl': '80rem', '2xl': '96rem' };
            const arbitraryValueRegex = /(.+?)-\[(.+)\]/;

            for (let className of classes) {
                let isImportant = false;
                if (className.startsWith('!')) {
                    isImportant = true;
                    className = className.substring(1);
                }

                const parts = className.split(':');
                let baseClass = parts.pop();
                const variantPrefixes = parts.sort();
                const variantKey = variantPrefixes.join(':');

                // Check if the class is a special directive for child styling
                if (directiveRegex.test(baseClass)) {
                    directives.push({ className: baseClass, variants: variantPrefixes });
                    continue;
                }

                let css = {};
                
                if (baseClass.includes('/') && !baseClass.startsWith('[')) {
                    const [classWithoutAlpha, alpha] = baseClass.split('/');
                    const colorUtility = tailwindMap[classWithoutAlpha];
                    if (colorUtility) {
                        const cssProp = Object.keys(colorUtility)[0];
                        const hexColor = colorUtility[cssProp];
                        const alphaValue = parseInt(alpha, 10) / 100;
                        const rgbaColor = hexToRgba(hexColor, alphaValue);
                        if(rgbaColor) {
                           css[cssProp] = rgbaColor;
                        }
                    }
                } else {
                     const match = baseClass.match(arbitraryValueRegex);
                     if (match) {
                         const prop = match[1];
                         let value = match[2].replace(/_/g, ' ');

                         if (prop === 'bg') {
                            if (value.startsWith('url(') || value.includes('gradient')) {
                                css['background-image'] = value;
                            } else {
                                css['background-color'] = value;
                            }
                         } else {
                            const gradientPropMap = {'from': '--tw-gradient-from-color', 'via': '--tw-gradient-via-color', 'to': '--tw-gradient-to-color'};
                            if (gradientPropMap[prop]) {
                                css[gradientPropMap[prop]] = value;
                            } else {
                                const cssPropMap = { 'w': 'width', 'h': 'height', 'p': 'padding', 'm': 'margin', 'text': 'color', 'border': 'border-color' };
                                const cssProp = cssPropMap[prop] || prop;
                                css[cssProp] = value;
                            }
                         }
                     } else if (tailwindMap[baseClass]) {
                         css = { ...tailwindMap[baseClass] };
                     } else {
                         continue; 
                     }
                }

                if (Object.keys(css).length === 0) continue;

                if (isImportant) {
                    Object.keys(css).forEach(key => css[key] = `${css[key]} !important`);
                }

                if (!variantKey) {
                    Object.assign(style, css);
                } else {
                    if (!groupedVariants[variantKey]) groupedVariants[variantKey] = {};
                    Object.assign(groupedVariants[variantKey], css);
                }
            }
            
            for (const key in groupedVariants) {
                const variant = { style: groupedVariants[key] };
                const prefixes = key.split(':');
                
                prefixes.forEach(prefix => {
                    if (responsivePrefixes[prefix]) {
                        variant.mediaQuery = { 'min-width': responsivePrefixes[prefix] };
                    } else if (pseudoClassMap[prefix]) {
                        const jsonKey = pseudoClassMap[prefix];
                        variant[jsonKey] = true;
                    }
                });
                variants.push(variant);
            }

            postProcessStyle(style, style);
            variants.forEach(variant => {
                postProcessStyle(variant.style, style);
            });
            
            return { style, variants, directives };
        }
        
        /**
         * Parses the content of <style> tags to find component classes with @apply.
         * @param {string} htmlString - The full HTML input string.
         * @returns {object} A map of component class names to their Tailwind utility strings.
         */
        const parseStyleTag = (htmlString) => {
            const componentClassMap = {};
            const styleRegex = /<style[^>]*>([\s\S]*?)<\/style>/g;
            const classRegex = /\.([\w-]+)\s*\{\s*@apply\s+([^;]+);/g;
            
            let styleMatch;
            while ((styleMatch = styleRegex.exec(htmlString)) !== null) {
                const styleContent = styleMatch[1];
                let classMatch;
                while((classMatch = classRegex.exec(styleContent)) !== null) {
                    const className = classMatch[1];
                    const utilities = classMatch[2].trim().replace(/\s+/g, ' ');
                    componentClassMap[className] = utilities;
                }
            }
            return componentClassMap;
        };

        /**
         * Expands a class string by replacing component classes with their utility strings.
         * @param {string} classString - The class string from the HTML element.
         * @param {object} componentMap - The map of component classes to utilities.
         * @returns {string} The expanded string of utility classes.
         */
        const expandClasses = (classString, componentMap) => {
            if (!classString) return '';
            const classes = classString.split(/\s+/);
            const expanded = classes.map(cls => componentMap[cls] || cls);
            return expanded.join(' ');
        };

        function processNode(domNode, nodes, componentClassMap) {
            if ((domNode.nodeType === 3 && !domNode.nodeValue.trim()) || domNode.nodeType === 8 || domNode.tagName?.toLowerCase() === 'style' || domNode.tagName?.toLowerCase() === 'script') {
                return null;
            }

            const id = crypto.randomUUID();
            let nodeData;
            const tagName = domNode.tagName ? domNode.tagName.toLowerCase() : null;

            if (domNode.nodeType === 1) { // Element node
                const classNameString = (typeof domNode.className === 'object' && domNode.className.baseVal !== undefined)
                    ? domNode.className.baseVal
                    : domNode.className;

                const expandedClassString = expandClasses(classNameString, componentClassMap);
                const { style, variants, directives } = parseTailwind(expandedClassString);
                
                const tableDisplayMap = {
                    'table': 'table', 'thead': 'table-header-group', 'tbody': 'table-row-group',
                    'tfoot': 'table-footer-group', 'tr': 'table-row', 'th': 'table-cell',
                    'td': 'table-cell', 'caption': 'table-caption'
                };

                const finalStyle = {
                    'border-style': 'solid',
                    'border-width': '0',
                    ...style
                };
                
                if (!style.display) {
                    if (tableDisplayMap[tagName]) {
                         finalStyle.display = tableDisplayMap[tagName];
                    } else {
                        finalStyle.display = 'flex';
                        finalStyle['flex-direction'] = 'column';
                    }
                } else if (style.display.includes('flex') && !style['flex-direction']) {
                    finalStyle['flex-direction'] = 'row';
                }
                
                nodeData = {
                    type: 'element',
                    tag: tagName === 'body' ? 'div' : tagName,
                    classes: {},
                    attrs: {},
                    events: {},
                    style: finalStyle,
                    directives: directives,
                    variants: variants,
                    children: []
                };

                for (const attr of domNode.attributes) {
                    if (attr.name !== 'class' && attr.name !== 'style') {
                        nodeData.attrs[attr.name] = { type: 'value', value: attr.value };
                    }
                }
                
                if (domNode.style && domNode.style.cssText) {
                    const inlineStyles = domNode.style.cssText.split(';').filter(s => s.trim());
                    inlineStyles.forEach(s => {
                        const [key, value] = s.split(':').map(p => p.trim());
                        if (key && value) nodeData.style[key] = value;
                    });
                }
                
                for (const child of domNode.childNodes) {
                    const childId = processNode(child, nodes, componentClassMap);
                    if (childId) nodeData.children.push(childId);
                }

            } else if (domNode.nodeType === 3) { // Text node
                nodeData = { type: 'text', value: { type: 'value', value: domNode.nodeValue.trim() } };
            }
            
            if (nodeData) {
                nodes[id] = nodeData;
                return id;
            }
            return null;
        }

        // --- SECOND PASS: APPLY DIRECTIVES ---
        function applyDirectives(nodes) {
             for (const nodeId in nodes) {
                const parentNode = nodes[nodeId];
                if (!parentNode.directives || parentNode.directives.length === 0 || !parentNode.children || parentNode.children.length === 0) {
                    continue;
                }

                const childrenToModify = parentNode.children.slice(1);

                for(const directive of parentNode.directives) {
                    const { className, variants: directiveVariants } = directive;

                    let styleToApply = {};

                    if (className.startsWith('space-y-')) {
                        const key = className.replace('space-y-', '');
                        if(spacingScale[key]) styleToApply['margin-top'] = spacingScale[key];
                    } else if (className.startsWith('space-x-')) {
                         const key = className.replace('space-x-', '');
                        if(spacingScale[key]) styleToApply['margin-left'] = spacingScale[key];
                    } else if (className.startsWith('divide-y')) {
                        const width = className === 'divide-y' ? '1px' : (spacingScale[className.replace('divide-y-','')] || '1px');
                        styleToApply['border-top-width'] = width;
                    } else if (className.startsWith('divide-x')) {
                         const width = className === 'divide-x' ? '1px' : (spacingScale[className.replace('divide-x-','')] || '1px');
                        styleToApply['border-left-width'] = width;
                    } else if (className.startsWith('divide-')) {
                        const colorClass = className.replace('divide-', 'border-');
                        if (tailwindMap[colorClass] && tailwindMap[colorClass]['--tw-divide-color']) {
                           styleToApply['border-color'] = tailwindMap[colorClass]['--tw-divide-color'];
                        }
                    }

                    if (Object.keys(styleToApply).length === 0) continue;
                    
                    for (const childId of childrenToModify) {
                        const childNode = nodes[childId];
                        if (!childNode) continue;
                        
                        if(directiveVariants.length === 0) {
                            Object.assign(childNode.style, styleToApply);
                        } else {
                            const variantConditions = {};
                            directiveVariants.forEach(prefix => {
                                const responsivePrefixes = { 'sm': '40rem', 'md': '48rem', 'lg': '64rem', 'xl': '80rem', '2xl': '96rem' };
                                 if (responsivePrefixes[prefix]) {
                                    variantConditions.mediaQuery = { 'min-width': responsivePrefixes[prefix] };
                                } else if (pseudoClassMap[prefix]) {
                                    variantConditions[pseudoClassMap[prefix]] = true;
                                }
                            });

                            let targetVariant = childNode.variants.find(v => 
                                JSON.stringify(Object.keys(v).sort()) === JSON.stringify(Object.keys(variantConditions).concat('style').sort()) &&
                                Object.keys(variantConditions).every(k => JSON.stringify(v[k]) === JSON.stringify(variantConditions[k]))
                            );

                            if(targetVariant) {
                                Object.assign(targetVariant.style, styleToApply);
                            } else {
                                childNode.variants.push({ ...variantConditions, style: styleToApply });
                            }
                        }
                    }
                }
             }
        }


        function convert() {
            const html = htmlInput.value;
            if (!html.trim()) {
                jsonOutput.textContent = '';
                outputPlaceholder.style.display = 'flex';
                return;
            }

            try {
                const componentClassMap = parseStyleTag(html);
                
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                let rootElement;
                
                if (doc.body.children.length === 1 && !['STYLE', 'SCRIPT'].includes(doc.body.firstElementChild.tagName)) {
                    rootElement = doc.body.firstElementChild;
                } else {
                     const tempWrapper = document.createElement('div');
                     Array.from(doc.body.childNodes).forEach(child => {
                         if (child.nodeType !== 8 && !['style', 'script'].includes(child.tagName?.toLowerCase())) {
                             tempWrapper.appendChild(child.cloneNode(true));
                         }
                     });
                     rootElement = tempWrapper;
                }

                // Pass 1: Build the tree and collect directives
                const nodes = {};
                const rootId = processNode(rootElement, nodes, componentClassMap);
                
                // Pass 2: Apply directives to children
                applyDirectives(nodes);

                if (rootId) {
                    const rootNodeData = nodes[rootId];
                    delete nodes[rootId];
                    // Clean up the directives property from the final output as it has been processed
                    Object.values(nodes).forEach(node => delete node.directives);
                    delete rootNodeData.directives;
                    nodes['root'] = rootNodeData;
                }

                const finalJson = { type: 'nodes', nodes: nodes };
                jsonOutput.textContent = JSON.stringify(finalJson, null, 2);
                outputPlaceholder.style.display = 'none';

            } catch (error) {
                console.error("Conversion Error:", error);
                jsonOutput.textContent = JSON.stringify({ error: "Failed to parse HTML.", message: error.message }, null, 2);
                outputPlaceholder.style.display = 'none';
            }
        }
        
        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            toast.classList.remove('opacity-0');
            toast.className = toast.className.replace(/bg-(red|gray)-[0-9]+/g, '');
            toast.classList.add(type === 'error' ? 'bg-red-600' : 'bg-gray-800');
            setTimeout(() => toast.classList.add('opacity-0'), 2500);
        }

        // --- Event Listeners ---
        convertBtn.addEventListener('click', convert);
        
        pasteSampleBtn.addEventListener('click', () => {
            htmlInput.value = sampleHtml;
            convert();
        });
        
        pasteFromClipboardBtn.addEventListener('click', async () => {
            try {
                const text = await navigator.clipboard.readText();
                if (text) {
                    htmlInput.value = text;
                    showToast("Pasted from clipboard!");
                    convert();
                } else {
                    showToast("Clipboard is empty.", "error");
                }
            } catch (err) {
                console.error('Failed to read clipboard contents: ', err);
                showToast("Could not access clipboard.", "error");
            }
        });

        copyBtn.addEventListener('click', () => {
            if (jsonOutput.textContent) {
                navigator.clipboard.writeText(jsonOutput.textContent).then(() => {
                    showToast("Copied to clipboard!");
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                    showToast("Failed to copy.", "error");
                });
            }
        });
        
        // Initial conversion on load
        pasteSampleBtn.click();
    </script>
</body>
</html>